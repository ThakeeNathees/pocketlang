<!DOCTYPE html>
<html>
<head>
	<title>Fibers - PocketLang</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" type="text/css" href="static/main.css">
	<link rel="stylesheet" type="text/css" href="static/pygments.css">
	<link rel="stylesheet" type="text/css" href="static/rage_font/style.css" />
	
	<!-- Additional javascript css files for wasm try. -->
	

</head>
	
	<body>
	
	<!-- Title header. -->
	<div class="container">
	<div id="header">
		<div id="header_content" class="container">
		<a href="index.html">
		<h1>pocketlang</h1>
		<h2>A small and fast language</h2>
		</a>
		</div>
	</div>
	</div>

	<div id="page">
	<div id="main-wrapper" class="container">
	<div id="main">
	
		<div id="content-wrapper">
		<div id="content">
			<h1>Fibers  <a href="#fibers" name="fibers" class="anchor">#</a></h1>
<p>Pocketlang support coroutines via <a href="https://en.wikipedia.org/wiki/Fiber_(computer_science)">fibers</a>
(light weight threads with cooperative multitask). A fiber object is a wrapper
around a function, contains the execution state (simply the stack and the
instruction pointer) for that function, which can be run and once yielded
resumed.</p>
<div class="codehilite"><pre><span></span><span class="k">import</span> <span class="no">Fiber</span>

<span class="k">def</span> <span class="nf">fn</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span>
<span class="k">end</span>

<span class="n">fb</span> <span class="o">=</span> <span class="no">Fiber</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>              <span class="c1"># Create a fiber.</span>
<span class="no">Fiber</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">fb</span><span class="p">,</span> <span class="s1">&#39;hello&#39;</span><span class="p">,</span> <span class="s1">&#39;world&#39;</span><span class="p">)</span> <span class="c1"># Run the fiber.</span>
</pre></div>


<h2>Yielding  <a href="#yielding" name="yielding" class="anchor">#</a></h2>
<p>When a function is yielded, it's state will be stored in the fiber it's
belongs to and will return from the function, to parent fiber it's running
from (not the caller of the function). And you can pass values between
fibers when they yield.</p>
<div class="codehilite"><pre><span></span><span class="k">import</span> <span class="no">Fiber</span>

<span class="k">def</span> <span class="nf">fn</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;running&#39;</span><span class="p">)</span>
    <span class="k">yield</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;resumed&#39;</span><span class="p">)</span>
<span class="k">end</span>

<span class="n">fb</span> <span class="o">=</span> <span class="no">Fiber</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
<span class="no">Fiber</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">fb</span><span class="p">)</span>    <span class="c1"># Prints &#39;running&#39;.</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;before resumed&#39;</span><span class="p">)</span>
<span class="no">Fiber</span><span class="o">.</span><span class="n">resume</span><span class="p">(</span><span class="n">fb</span><span class="p">)</span> <span class="c1"># Prints &#39;resumed&#39;.</span>
</pre></div>


<p>Yield from the fiber with a value.</p>
<div class="codehilite"><pre><span></span><span class="k">import</span> <span class="no">Fiber</span>

<span class="k">def</span> <span class="nf">fn</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;running&#39;</span><span class="p">)</span>
    <span class="k">yield</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span> <span class="c1"># Return 42.</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;resumed&#39;</span><span class="p">)</span>
<span class="k">end</span>

<span class="n">fb</span> <span class="o">=</span> <span class="no">Fiber</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
<span class="n">val</span> <span class="o">=</span> <span class="no">Fiber</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">fb</span><span class="p">)</span> <span class="c1"># Prints &#39;running&#39;.</span>
<span class="nb">print</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>          <span class="c1"># Prints 42.</span>
<span class="no">Fiber</span><span class="o">.</span><span class="n">resume</span><span class="p">(</span><span class="n">fb</span><span class="p">)</span>    <span class="c1"># Prints &#39;resumed&#39;.</span>
</pre></div>


<p>Resume the fiber with a value.</p>
<div class="codehilite"><pre><span></span><span class="k">import</span> <span class="no">Fiber</span>

<span class="k">def</span> <span class="nf">fn</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;running&#39;</span><span class="p">)</span>
    <span class="n">val</span> <span class="o">=</span> <span class="k">yield</span><span class="p">()</span> <span class="c1"># Resumed value.</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>    <span class="c1"># Prints 42.</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;resumed&#39;</span><span class="p">)</span>
<span class="k">end</span>

<span class="n">fb</span> <span class="o">=</span> <span class="no">Fiber</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
<span class="n">val</span> <span class="o">=</span> <span class="no">Fiber</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">fb</span><span class="p">)</span>  <span class="c1"># Prints &#39;running&#39;.</span>
<span class="no">Fiber</span><span class="o">.</span><span class="n">resume</span><span class="p">(</span><span class="n">fb</span><span class="p">,</span> <span class="mi">42</span><span class="p">)</span> <span class="c1"># Resume with 42, Prints &#39;resumed&#39;.</span>
</pre></div>


<p>Once a fiber is done execution, trying to resume it will cause a runtime
error. To check if the fiber is finished check its attribute
<code>is_done</code> and use the attribute <code>function</code> to get it's function,
which could be used to create a new fiber to "re-start" the fiber.</p>
<div class="codehilite"><pre><span></span><span class="k">import</span> <span class="no">Fiber</span>

<span class="no">Fiber</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">fb</span> <span class="o">=</span> <span class="no">Fiber</span><span class="o">.</span><span class="n">new</span><span class="p">(</span>
<span class="k">func</span><span class="p">()</span>
  <span class="k">for</span> <span class="n">i</span> <span class="k">in</span> <span class="mi">0</span><span class="o">..</span><span class="mi">5</span> <span class="k">do</span>
    <span class="k">yield</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span><span class="p">))</span>

<span class="k">while</span> <span class="ow">not</span> <span class="n">fb</span><span class="o">.</span><span class="n">is_done</span>
    <span class="no">Fiber</span><span class="o">.</span><span class="n">resume</span><span class="p">(</span><span class="n">fb</span><span class="p">)</span>
<span class="k">end</span>

<span class="c1"># Get the function from the fiber.</span>
<span class="n">fn</span> <span class="o">=</span> <span class="n">fb</span><span class="o">.</span><span class="n">function</span>
</pre></div>
		</div>
		</div>

		<div id="sidebar-wrapper">
		<div id="sidebar">
			<!-- <img src=" $sttaicdir/ icon.png" style="width:120px"> -->
			<div class="navigation">
<h3><strong>Getting Started</strong></h3>
<ul class="menu">
<li><a href="getting-started-try-it-now.html">Try It Now</a></li>
<li><a href="getting-started-learn-in-15-minutes.html">Learn In 15 Minutes</a></li>
<li><a href="getting-started-build-from-source.html">Build From Source</a></li>
<li><a href="getting-started-contributing.html">Contributing</a></li>
</ul>
</div>
<div class="navigation">
<h3><strong>Language Api</strong></h3>
<ul class="menu">
<li><a href="language-api-variables.html">Variables</a></li>
<li><a href="language-api-functions.html">Functions</a></li>
<li><a href="language-api-fibers.html">Fibers</a></li>
<li><a href="language-api-modules.html">Modules</a></li>
</ul>
</div>

		</div>
		</div>

	</div>
	</div>
	</div>

	<br>
	
	<div class="container">
	<div id="footer">
        <p>Made by <a href="https://github.com/ThakeeNathees">Thakee Nathees</a>
		on <a href="https://github.com/ThakeeNathees/pocketlang">github</a>.</p>
	</div>
	</div>


	</body>
</html>
